@using System.Data;
@{
    ViewData["Title"] = "OpenDepositAccount";
    Layout = "~/Views/Shared/_Layout1.cshtml";
}

@{
    var ListData = TempData["data"] as DataSet;
    var AccountsListData = ListData?.Tables[0];
    var schemeList = ListData?.Tables[1];
}


<div class="row">
    <!--  page header -->
    <div class="col-lg-12">
        <h1 class="page-header">Deposit Account</h1>
    </div>
    <!-- end  page header -->
</div>

<div class="row">
    <div class="col-lg-12">
        <!-- Form Elements -->
        <div class="panel panel-default">
            <div class="panel-heading">
                <div class="row">
                    <div class="col-md-6">To Add New Account Please Enter Membership Number and Verify</div>
                    <div class="col-md-6">
                        <input style="padding:5px 10px" id="membershipNumber" placeholder="Enter Membership Number" />
                        <button id="VerifyButton" style="margin-left:20px;padding:5px 20px" class="btn btn-success">Verify</button>
                    </div>


                </div>

            </div>
            <div class="panel-body" style="display:none" id="memberDetailsSection">
                <div class="row">
                    <div class="form-group col-lg-6 ">
                        <label>Member Name</label>
                        <input readonly="readonly" id="memberName" class="form-control">
                    </div>
                    <div class="form-group col-lg-6">
                        <label>Membership Number</label>
                        <input readonly="readonly" id="membershipNo" class="form-control" placeholder="Enter text">
                    </div>
                    <div class="form-group col-lg-6 ">
                        <label>Mobile Number</label>
                        <input readonly="readonly" maxlength="10" id="mobileNumber" class="form-control">
                    </div>
                    <div class="form-group col-lg-6">
                        <label>Email</label>
                        <input readonly="readonly" id="emailAddress" class="form-control" placeholder="Enter text">
                    </div>

                    <div class="form-group col-lg-6">
                        <label>Account Scheme</label>

                        <select class="form-control" id="accountScheme">
                            @*<option value="0">Select Scheme</option>*@
                            @for (int i = 0; i < schemeList?.Rows.Count; i++)
                            {
                                <option value=@schemeList.Rows[i]["Fld_SchemeCode"]>@schemeList.Rows[i]["Fld_SchemeName"]</option>
                            }


                        </select>
                    </div>
                    <div class="form-group col-lg-6">
                        <label>Start Date</label>
                        <input class="form-control" id="startDate" type="date">
                    </div>

                    <div class="form-group col-lg-6">
                        <label>Maturity Date</label>
                        <input id="maturityDate" type="date" class="form-control" placeholder="Enter text">
                    </div>

                    <div class="form-group col-lg-6">
                        <label>Deposit Amount</label>
                        <input id="depositAmount" class="form-control" type="number" placeholder="Enter number">
                    </div>



                </div>
                <div class="panel-footer">
                    <button type="submit" id="SubmitButton" class="btn btn-primary">Open Account</button>

                </div>
            </div>
        </div>
        <!-- End Form Elements -->
    </div>
</div>
<div class="row">
    <div class="col-lg-12">
        <!-- Advanced Tables -->
        <div class="panel panel-default">
            <div class="panel-heading">
                All Records

            </div>
            <div class="panel-body">
                @if (AccountsListData?.Rows.Count > 0)
                {
                    <div class="table-responsive">
                        <table class="table table-striped table-bordered table-hover" id="dataTables-example">
                            <thead>
                                <tr>
                                    <th>Sr No</th>
                                    <th>Membership Number</th>
                                    <th>Name</th>
                                    <th>Account Number</th>
                                    <th>Amount</th>
                                    <th>A/C Type</th>
                                    <th>Scheme</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                @{
                                    var srNO = 1;
                                }
                                @for (int i = 0; i < AccountsListData?.Rows.Count; i++)
                                {
                                    <tr class="odd gradeX">
                                        <td class="center">@srNO</td>
                                        <td class="center">@AccountsListData.Rows[i]["Fld_MembershipNumber"]</td>
                                        <td class="center">@AccountsListData.Rows[i]["Fld_MemberName"]</td>
                                        <td class="center">@AccountsListData.Rows[i]["Fld_AccountNumber"]</td>
                                        <td class="center">@AccountsListData.Rows[i]["Fld_Amount"]</td>
                                        <td class="center">@AccountsListData.Rows[i]["Fld_SchemeName"]</td>
                                        <td class="center">@AccountsListData.Rows[i]["Fld_SchemeType"]</td>
                                        <td class="center">@AccountsListData.Rows[i]["Fld_Status"]</td>
                                    </tr>
                                    srNO++;
                                }
                            </tbody>
                        </table>
                    </div>
                }
                else
                {
                    <h3 class="text-center">No Records Availble!</h3>
                }
            </div>
        </div>
        <!--End Advanced Tables -->

    </div>
</div>



@section Scripts{
    <!-- Page-Level Plugin Scripts-->
    <script src="/assets/plugins/dataTables/jquery.dataTables.js"></script>
    <script src="/assets/plugins/dataTables/dataTables.bootstrap.js"></script>
    <script>
        $(document).ready(function () {
            $('#dataTables-example').dataTable();
        });
    </script>
    <script>
        $(document).ready(function () {
            $("#VerifyButton").click(function () {
                var val = $("#membershipNumber").val();
                $.ajax({
                    type: 'GET',
                    url: `/api/MasterApi/VerifyMember?membershipNumber=${$("#membershipNumber").val()}`,
                    success: function (response) {
                        console.log(response.data);
                        if (response.fld_Status == 1) {
                            $("#memberName").val(response.data[0].fld_MemberName);
                            $("#membershipNo").val(response.data[0].fld_MembershipNumber);
                            //$("#membershipNo").val($("#membershipNumber").val());
                            $("#mobileNumber").val(response.data[0].fld_MobileNumber);
                            $("#emailAddress").val(response.data[0].fld_EmailAddress);
                            //$("#creationDate").val(response.data[0].fld_CreateDate);


                            //$('#memberSearchSection').hide();
                            //$('#memberDetailsSection').show();

                            //$("#memberSearchSection").css("display", "none");
                            $("#memberDetailsSection").css("display", "block");

                            $("#memberSearchSection").prop("disabled", true);


                        }
                        else {
                            alert("No Record Found");
                        }

                    },
                    Error: function (e) {
                        console.log(e);
                    },

                });
            });

            $("#SubmitButton").click(function () {
                var vals = {
                    "Fld_StartDate": $("#startDate").val(),
                    "Fld_MembershipNumber": $("#membershipNo").val(),
                    "Fld_SchemeCode": $("#accountScheme").val(),
                    "Fld_MaturityDate": $("#maturityDate").val(),
                    "Fld_Amount": $("#depositAmount").val(),
                }


                $.ajax({
                    type: 'Post',
                    data: JSON.stringify(vals),
                    url: "/api/MasterApi/OpenDepositAccount",
                    contentType: "application/json",
                    success: function (response) {
                        console.log(response);
                        if (response.fld_Status == 1) {
                            alert(`Account Successfully Created AccNo: ${response.fld_AccountNumber}`);
                            location.reload();
                        }
                        else {
                            alert("Please Contact to Developer");
                        }
                    },
                    Error: function (e) {
                        console.log(e);
                    },
                    catch: function (e) {
                        console.log(e);
                    }

                });
            });
        });
    </script>

}

